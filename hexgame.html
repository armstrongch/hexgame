<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Hex Game</title>
		<style type="text/css">
			body {
				<!---color: black;-->
				<!---color: white;-->
				font-size: 14px;
			}
			
			.ms {
				font-family: monospace;
			}
			.tooltip {
				position: relative;
				display: inline-block;
				cursor: help;
			}

			/* Tooltip text */
			.tooltip .tooltiptext {
				visibility: hidden;
				width: 120px;
				background-color: black;
				color: #fff;
				text-align: center;
				padding: 5px 0;
				border-radius: 6px;

				position: absolute;
				z-index: 1;
			}

			/* Show the tooltip text when you mouse over the tooltip container */
			.tooltip:hover .tooltiptext {
				visibility: visible;
				top: -5px;
				left: 115%;
			}
		</style>
	</head>
	
	<body onload="setup()" onkeydown="keyDown(event)">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
		<div id="drawDiv" class="ms"></div>
		<br/>
		<div id="resizeDiv">
			Font Size:<input type="number" value="14" onchange="changeFontSize()" id="fontSizePicker"> <span onclick="hideFontSizePicker()" style="cursor: pointer;">(Hide)</span>
		</div>
		<p>Movement Controls: Q W E A S D</p>
		<script>
			function keyDown(event)
			{
				if (grid.length == 0)
				{
					return;
				}
				if (event.keyCode == 87) // w
				{
					if (grid[playerCol][playerCell-1] == "&nbsp;")
					{
						removeGridItem(playerCol, playerCell);
						playerCell--;
						addGridItem(playerCol, playerCell, "@");
						drawGrid();
					}
					else
					{
						// handle collisions here
					}
				}
				else if (event.keyCode == 83) // s
				{
					if (grid[playerCol][playerCell+1] == "&nbsp;")
					{
						removeGridItem(playerCol, playerCell);
						playerCell++;
						addGridItem(playerCol, playerCell, "@");
						drawGrid();
					}
					else
					{
						// handle collisions here
					}
				}
				else if (event.keyCode == 65) // a
				{
					var targetCol = playerCol - 1;
					var targetCell = playerCell;
					if (playerCol%2 == 1)
					{
						targetCell = playerCell + 1;
					}
					
					if (grid[targetCol][targetCell] == "&nbsp;")
					{
						removeGridItem(playerCol, playerCell);
						playerCol = targetCol;
						playerCell = targetCell;
						addGridItem(playerCol, playerCell, "@");
						drawGrid();
					}
					else
					{
						// handle collisions here
					}
				}
				else if (event.keyCode == 68) // d
				{
					var targetCol = playerCol + 1;
					var targetCell = playerCell;
					if (playerCol%2 == 1)
					{
						targetCell = playerCell + 1;
					}
					
					if (grid[targetCol][targetCell] == "&nbsp;")
					{
						removeGridItem(playerCol, playerCell);
						playerCol = targetCol;
						playerCell = targetCell;
						addGridItem(playerCol, playerCell, "@");
						drawGrid();
					}
					else
					{
						// handle collisions here
					}
				}
				else if (event.keyCode == 81) // q
				{
					var targetCol = playerCol - 1;
					var targetCell = playerCell - 1;
					if (playerCol%2 == 1)
					{
						targetCell = playerCell;
					}
					
					if (grid[targetCol][targetCell] == "&nbsp;")
					{
						removeGridItem(playerCol, playerCell);
						playerCol = targetCol;
						playerCell = targetCell;
						addGridItem(playerCol, playerCell, "@");
						drawGrid();
					}
					else
					{
						// handle collisions here
					}
				}
				else if (event.keyCode == 69) // e
				{
					var targetCol = playerCol + 1;
					var targetCell = playerCell - 1;
					if (playerCol%2 == 1)
					{
						targetCell = playerCell;
					}
					
					if (grid[targetCol][targetCell] == "&nbsp;")
					{
						removeGridItem(playerCol, playerCell);
						playerCol = targetCol;
						playerCell = targetCell;
						addGridItem(playerCol, playerCell, "@");
						drawGrid();
					}
					else
					{
						// handle collisions here
					}
				}
			}
			
			function changeFontSize()
			{
				var newSize = $('#fontSizePicker').val() + "px";
				$('body').css('font-size', newSize);
			}
			
			function hideFontSizePicker()
			{
				$('#resizeDiv').css('display', 'none');
			}
			
			var hexAscii = 
			[
				"&nbsp;&nbsp;&nbsp;_______&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",//0
				"&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",//1
				"&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",//2
				"/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[REPLACE_ME_0]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\________",//3
				"\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",//4
				"&nbsp;\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;", //5
				"&nbsp;&nbsp;\\_______/&nbsp;&nbsp;&nbsp;&nbsp;[REPLACE_ME_1]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",//6
			];
			
			var spaceAscii = "&nbsp;";
			
			var grid = [];
			var tooltips = [];
			var width = 0;
			var height = 0;
			var playerCol = 0;
			var playerCell = 0;
			
			function setup()
			{
				grid = [];
				tooltips = [];
				width = 5;
				height = 5;
				lines = "";
				
				for (let w = 0; w < width; w++)
				{
					var col = [];
					var colClone = [];
					var secondCol = [];
					var secondColClone = [];
					for (let h = 0; h < height; h++)
					{
						col.push("&nbsp;");
						colClone.push("&nbsp;");
						if ((w < width - 1) && (h < height - 1))
						{
							secondCol.push("&nbsp;");
							secondColClone.push("&nbsp;");
						}
					}
					grid.push(col);
					tooltips.push(colClone);
					if (secondCol.length > 0)
					{
						grid.push(secondCol);
						tooltips.push(secondColClone);
					}
				}
				
				addGridItem(0, 0, "^"); //Pine Tree
				addGridItem(0, 1, "^"); //Pine Tree
				addGridItem(0, 2, "^"); //Pine Tree
				addGridItem(1, 0, "^"); //Pine Tree
				addGridItem(2, 2, "^"); //Pine Tree
				addGridItem(3, 0, "^"); //Pine Tree
				
				addGridItem(4, 1, "@"); //The Wanderer
				playerCol = 4;
				playerCell = 1;
				
				drawGrid();
			}
			
			var tooltipReference =
			{
				"@": "The Wanderer",
				"^": "Pine Tree"
			}
			
			function addGridItem(w, h, symbol)
			{
				grid[w][h] = symbol;
				if (symbol in tooltipReference)
				{
					tooltips[w][h] = tooltipReference[symbol];
				}
			}
			
			function removeGridItem(w, h)
			{
				grid[w][h] = "&nbsp;";
				tooltips[w][h] = "&nbsp;";
			}
			
			function drawGrid()
			{
				var lines = "";
				
				for (let h = 0; h < height + 1; h++)
				{
					for (let a = 0; a < hexAscii.length - 1; a++)
					{
						var line = "";
						for (let w = 0; w < width; w++)
						{
							
							var asciiReplaceIndex = w%2;
							
							if (h == height)
							{
								a = hexAscii.length - 1;
								line += hexAscii[6];
							}
							else if (a == 0)
							{
								if (h == 0)
								{
									line += hexAscii[0];
								}
								else
								{
									var addToLine = hexAscii[6];

									if (w*2+1 < grid.length)
									{
										var replacementSymbol = grid[w*2+1][h-1];
										if (tooltips[w*2+1][h-1] != "&nbsp;")
										{
											replacementSymbol = "<span class=\"tooltip\">" + grid[w*2+1][h-1] + "<span class=\"tooltiptext\">" + tooltips[w*2+1][h-1] + "</span></span>";
										}
										addToLine = addToLine.replace("[REPLACE_ME_1]", replacementSymbol);
									}
									
									line += addToLine;
								}
							}
							else
							{
								var addToLine = hexAscii[a];
								if ((a == 3) && (w == width - 1))
								{
									addToLine = hexAscii[a].substring(0, hexAscii[a].indexOf("\\") + 1);
								}
								if (h <= grid[w].length)
								{
									if (a == 3)
									{
										var replacementSymbol = grid[w*2][h];
										if (tooltips[w*2][h] != "&nbsp;")
										{
											replacementSymbol = "<span class=\"tooltip\">" + grid[w*2][h] + "<span class=\"tooltiptext\">" + tooltips[w*2][h] + "</span></span>";
										}
										addToLine = addToLine.replace("[REPLACE_ME_0]", replacementSymbol);
									}
								}
								
								line += addToLine;
							}
						}
						lines += line + "<br/>";
					}
				}
				
				lines = lines.replace(/\[REPLACE_ME_0\]/g, "&nbsp;");
				lines = lines.replace(/\[REPLACE_ME_1\]/g, "&nbsp;");
				
				$('#drawDiv').html(lines);
			}
		</script>
	</body>
</html>
